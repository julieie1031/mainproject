--커뮤니티 테이블 생성
CREATE TABLE BOARD
(
BNO NUMBER(38),
USER_ID VARCHAR2(100) NOT NULL,
TITLE VARCHAR2(100) NOT NULL,
CONTENT VARCHAR2(100) NOT NULL, 
HIT NUMBER(38) DEFAULT 0,
BOARD_DATE DATE DEFAULT SYSDATE,
BOARD_UPDATE_DATE DATE DEFAULT SYSDATE
);

--커뮤니티 데이터 삽입
INSERT INTO BOARD (BNO, USER_ID, TITLE, CONTENT, HIT, GOOD) VALUES
(SQS_BOARD.NEXTVAL, '작성자03', '테스트 제목3', '테스트 내용3', 3, 1);

--커뮤니티 게시글 번호 시퀀스
CREATE SEQUENCE SQS_BOARD
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--커뮤니티 식별키 지정
ALTER TABLE BOARD ADD CONSTRAINT PK_BOARD1
PRIMARY KEY (BNO);

--댓글 테이블 생성
CREATE TABLE REPLY
(
RNO NUMBER(38),
BNO NUMBER(38) NOT NULL,
USER_ID VARCHAR2(100) NOT NULL, 
REPLY_CONTENT VARCHAR2(100) NOT NULL, 
REPLY_DATE DATE DEFAULT SYSDATE,
REPLY_UPDATE_DATE DATE DEFAULT SYSDATE
);

--댓글 번호 시퀀스
CREATE SEQUENCE SQS_REPLY
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--댓글 테이블 식별키 지정
ALTER TABLE REPLY ADD CONSTRAINT PK_REPLY1 PRIMARY KEY (RNO);

--댓글 테이블 외래키 지정
ALTER TABLE REPLY ADD CONSTRAINT FK_REPLY_BOARD1
FOREIGN KEY (BNO) REFERENCES BOARD (BNO);

CREATE INDEX INDEX_REPLY ON REPLY(BNO DESC, RNO ASC);

--REPLYCNT 열 추가
ALTER TABLE BOARD ADD (REPLY_CNT NUMBER DEFAULT 0);

UPDATE BOARD SET REPLYCNT = (SELECT COUNT(RNO) FROM REPLY
WHERE REPLY.BNO = BOARD.BNO);

--커뮤니티 이미지 테이블
CREATE TABLE ATTACH
(
UUID VARCHAR2(100) NOT NULL,
UPLOAD_PATH VARCHAR2(100) NOT NULL, --날짜
FILE_NAME VARCHAR2(100) NOT NULL,
FILE_TYPE VARCHAR2(100) NOT NULL, 
USER_ID VARCHAR2(100),
BNO NUMBER(38)
);

--이미지 테이블 식별키 지정
ALTER TABLE ATTACH ADD CONSTRAINT PK_ATTACH1 PRIMARY KEY(UUID);

--커뮤니티 테이블 이미지 외래키 지정
ALTER TABLE ATTACH ADD CONSTRAINT FK_BOARD_ATTACH1 FOREIGN KEY(BNO)
REFERENCES BOARD(BNO);

--숙소정보
CREATE TABLE REST (
REST_ID NUMBER(38) PRIMARY KEY,          -- 숙소 아이디
REST_NAME VARCHAR(100),        -- 숙소 이름
REST_ADDRESS VARCHAR2(100),     -- 숙소 위치      
REST_PHONE VARCHAR2(100),       -- 숙소 전화번호
REST_CONTENT VARCHAR2(500),     -- 숙소 설명
REST_IMAGE VARCHAR2(100)        -- 숙소 사진
);

--REST 테이블 별점 컬럼 추가
ALTER TABLE REST ADD STAR_AVG NUMBER(3,2);

-- 숙소 시퀀스
CREATE SEQUENCE SEQ_REST
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--숙소 데이터 삽입
INSERT INTO REST VALUES (SEQ_REST.NEXTVAL,'멍멍호텔','서울시 관악구','02-0000-0000','댕댕이와 함께 수영장을 즐길 수 있는 곳입니다.','hotel.jpg');
INSERT INTO REST VALUES (SEQ_REST.NEXTVAL,'반려호텔','서울시 강남구','02-1111-1111','댕댕이와 함께 수영장을 즐길 수 있는 곳입니다.','hotel2.jpg');
INSERT INTO REST VALUES (SEQ_REST.NEXTVAL,'왕왕호텔','서울시 동작구','02-2222-2222','댕댕이와 함께 수영장을 즐길 수 있는 곳입니다.','hotel3.jpg');

CREATE TABLE REST_DETAIL
(
ROOM_ID NUMBER(38) PRIMARY KEY,
ROOM_NAME VARCHAR2(100),
ROOM_PEOPLE VARCHAR2(100),
ROOM_PRICE NUMBER(38),
ROOM_DESCRIPTION VARCHAR2(1000),
ROOM_IMAGE VARCHAR2(100),
REST_ID NUMBER(38),
CONSTRAINT FK_REST_DETAIL FOREIGN KEY(REST_ID) REFERENCES REST(REST_ID)
);

-- 객실정보 시퀀스
CREATE SEQUENCE SEQ_REST_DETAIL
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--호텔정보 데이터 삽입
INSERT INTO REST_DETAIL VALUES(SEQ_REST_DETAIL.NEXTVAL,'디럭스 더블','2~3인',65000,'객실상세정보','room1.png',16);
INSERT INTO REST_DETAIL VALUES(SEQ_REST_DETAIL.NEXTVAL,'디럭스 패밀리','4~5인',95000,'객실상세정보','room2.png',16);
INSERT INTO REST_DETAIL VALUES(SEQ_REST_DETAIL.NEXTVAL,'디럭스 킹','3~4인',120000,'객실상세정보','room3.png',16);
INSERT INTO REST_DETAIL VALUES(SEQ_REST_DETAIL.NEXTVAL,'스위트 더블','2인',140000,'객실상세정보','room4.png',16);
INSERT INTO REST_DETAIL VALUES(SEQ_REST_DETAIL.NEXTVAL,'스위트 패밀리','4~5인',220000,'객실상세정보','room5.png',16);

--예약현황
CREATE TABLE RESERVATION
(
RESER_ID NUMBER(38) PRIMARY KEY,
ROOM_NAME VARCHAR2(100),
ROOM_PEOPLE VARCHAR2(100),
ROOM_PRICE NUMBER(38),
REST_PHONE VARCHAR2(100),
DOG_TYPE VARCHAR2(100),
DOG_NUMBER NUMBER(38),
REST_NAME VARCHAR2(100),
START_DATE  VARCHAR2(30),
END_DATE  VARCHAR2(30),
REST_ID NUMBER(38),
USER_ID VARCHAR2(100),
CONSTRAINT FK_RESERVATION FOREIGN KEY(REST_ID) REFERENCES REST(REST_ID)
);

--예약현황 시퀀스
CREATE SEQUENCE SEQ_RESERVATION
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--공지 테이블 생성
CREATE TABLE NOTICE(
NNO NUMBER,
NOTICE_TITLE VARCHAR2(100),
NOTICE_CONTENT VARCHAR2(1024),
USER_ID VARCHAR2(100),
NOTICE_DATE DATE DEFAULT SYSDATE,
NOTICE_UPDATE_DATE DATE DEFAULT SYSDATE
);

INSERT INTO NOTICE (NNO, USER_ID, NOTICE_TITLE, NOTICE_CONTENT) VALUES
(SEQ_NOTICE.NEXTVAL, '작성자03', '테스트 제목3', '테스트 내용3');

--공지 시퀀스
CREATE SEQUENCE SEQ_NOTICE --시퀀스이름 EX_SEQ
INCREMENT BY 1 --증감숫자 1
START WITH 1 --시작숫자 1
MINVALUE 1 --최소값 1
MAXVALUE 1000 --최대값 1000
NOCYCLE; --순환하지않음

--상식 팁 테이블 생성
CREATE TABLE COMMONTIP(
TNO NUMBER,
TIP_TITLE VARCHAR2(100),
TIP_CONTENT VARCHAR2(1024),
USER_ID VARCHAR2(100),
TIP_DATE DATE DEFAULT SYSDATE,
TIP_UPDATE_DATE DATE DEFAULT SYSDATE
);

CREATE TABLE TIPATTACH
(
UUID VARCHAR2(100) NOT NULL,
UPLOAD_PATH VARCHAR2(100) NOT NULL,
FILE_NAME VARCHAR2(100) NOT NULL,
FILE_TYPE VARCHAR2(100) NOT NULL, 
USER_ID VARCHAR2(100),
TNO NUMBER
);

ALTER TABLE COMMONTIP ADD CONSTRAINT PK_TIP
PRIMARY KEY (TNO);

ALTER TABLE TIPATTACH ADD CONSTRAINT PK_TIPATTACH PRIMARY KEY(UUID);

ALTER TABLE TIPATTACH ADD CONSTRAINT FK_COMMONTIP_ATTACH FOREIGN KEY(TNO)
REFERENCES COMMONTIP(TNO);  

CREATE SEQUENCE SEQ_COMMONTIP
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--공지 게시글 번호 시퀀스
CREATE SEQUENCE SEQ_TIP
INCREMENT BY 1
START WITH 1
MAXVALUE 100000
MINVALUE 1
NOCYCLE
NOCACHE;

--회원 테이블
CREATE TABLE MEMBERS 
(
USERID VARCHAR2(100) PRIMARY KEY,
USERPWD VARCHAR2(100) NOT NULL,
USERNAME VARCHAR2(100) NOT NULL,
ADDRESS VARCHAR2(100),
PHONE VARCHAR2(100),
EMAIL VARCHAR2(100),
ENABLED VARCHAR2(10),
REGISTERDATE DATE DEFAULT SYSDATE
);

CREATE TABLE AUTHORITIES (
    USERID VARCHAR2(100) NOT NULL,
    AUTHORITY VARCHAR(50) NOT NULL,
    CONSTRAINT FK_AUTH_MEMBER FOREIGN KEY(USERID) REFERENCES MEMBERS(USERID)ON DELETE CASCADE
);

ALTER TABLE AUTHORITIES ADD CONSTRAINT FK_AUTH_MEMBER FOREIGN KEY(USERID) REFERENCES MEMBERS(USERID)ON DELETE CASCADE;

--호텔 리뷰 테이블
CREATE TABLE REVIEW(
    RENO NUMBER(38),
    REST_ID NUMBER(38),
    REVIEW VARCHAR2(1000) NOT NULL,
    REVIEWER VARCHAR2(100) NOT NULL,
    REVIEW_DATE DATE DEFAULT SYSDATE,
    REVIEW_UPDATEDATE DATE DEFAULT SYSDATE,
    STAR NUMBER(2,0) DEFAULT 0 NOT NULL
);

CREATE SEQUENCE SEQ_REVIEW;

ALTER TABLE REVIEW ADD CONSTRAINT PK_REVIEW PRIMARY KEY(RENO);

ALTER TABLE REVIEW ADD CONSTRAINT FK_REVIEW_REST FOREIGN KEY (REST_ID) REFERENCES REST(REST_ID);
